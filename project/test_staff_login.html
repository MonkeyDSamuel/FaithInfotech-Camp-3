<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Test Staff Login System</title>
  <link rel="stylesheet" href="css/login.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <h1><i class="fas fa-user-md"></i> Test Staff Login System</h1>
      <nav>
        <ul>
          <li><button onclick="window.location.href='pages/staff_login.html'" class="nav-btn">
            <i class="fas fa-sign-in-alt"></i> Open Login Page
          </button></li>
          <li><button onclick="window.location.href='pages/admin_login.html'" class="nav-btn">
            <i class="fas fa-user-shield"></i> Admin Login
          </button></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="test-section">
        <h2><i class="fas fa-info-circle"></i> Staff Login System</h2>
        <p>This page demonstrates the comprehensive staff login system with role-based authentication.</p>
        
        <div class="features-grid">
          <div class="feature-card">
            <h3><i class="fas fa-shield-alt"></i> Authentication Features</h3>
            <ul>
              <li>Role-based login (Doctor, Pharmacist, Receptionist, Lab Technician)</li>
              <li>Session management with expiration</li>
              <li>Remember me functionality</li>
              <li>Automatic logout on back button</li>
              <li>Password visibility toggle</li>
              <li>Form validation and error handling</li>
            </ul>
          </div>
          
          <div class="feature-card">
            <h3><i class="fas fa-users"></i> Dynamic Credentials</h3>
            <div class="credentials-list">
              <h4>How it works:</h4>
              <ul>
                <li>Staff credentials are loaded from admin dashboard data</li>
                <li>No hardcoded credentials - all data is dynamic</li>
                <li>Staff must be registered by admin first</li>
                <li>Passwords are auto-generated during registration</li>
              </ul>
              
              <h4>To test:</h4>
              <ul>
                <li>1. Register staff members in admin dashboard</li>
                <li>2. Use the generated Staff ID and password</li>
                <li>3. Select the appropriate role (matches department)</li>
                <li>4. Login to access respective dashboard</li>
              </ul>
              
              <div id="currentStaffList">
                <h4>Currently Registered Staff:</h4>
                <p id="staffCount">Loading...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="test-section">
        <h2><i class="fas fa-cogs"></i> Test Functions</h2>
        <div class="test-controls">
          <button onclick="testLogin()" class="btn btn-primary">
            <i class="fas fa-sign-in-alt"></i> Test Login
          </button>
          <button onclick="testSession()" class="btn btn-secondary">
            <i class="fas fa-database"></i> Check Session
          </button>
          <button onclick="clearSession()" class="btn btn-danger">
            <i class="fas fa-trash"></i> Clear Session
          </button>
          <button onclick="testBackButton()" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Test Back Button
          </button>
          <button onclick="updateStaffList()" class="btn btn-primary">
            <i class="fas fa-sync-alt"></i> Refresh Staff List
          </button>
          <button onclick="testCrossReference()" class="btn btn-secondary">
            <i class="fas fa-search"></i> Test Cross-Reference
          </button>
        </div>
        
        <div class="test-status">
          <div id="sessionStatus" class="status-card">
            <h3>Session Status</h3>
            <p id="sessionInfo">No active session</p>
          </div>
          <div id="loginHistory" class="status-card">
            <h3>Login History</h3>
            <p id="historyInfo">No login history</p>
          </div>
        </div>
      </div>

      <div class="test-section">
        <h2><i class="fas fa-route"></i> Dashboard Access</h2>
        <div class="dashboard-links">
          <a href="pages/doctor_dashboard.html" class="dashboard-link">
            <i class="fas fa-user-md"></i>
            <span>Doctor Dashboard</span>
          </a>
          <a href="pages/pharmacist_dashboard.html" class="dashboard-link">
            <i class="fas fa-pills"></i>
            <span>Pharmacist Dashboard</span>
          </a>
          <a href="pages/receptionist_dashboard.html" class="dashboard-link">
            <i class="fas fa-user-tie"></i>
            <span>Receptionist Dashboard</span>
          </a>
          <a href="pages/labtech_dashboard.html" class="dashboard-link">
            <i class="fas fa-microscope"></i>
            <span>Lab Technician Dashboard</span>
          </a>
        </div>
        <p class="note">Note: You must be logged in to access these dashboards. If not logged in, you'll be redirected to the login page.</p>
      </div>
    </div>
  </main>

  <script src="js/staff.js"></script>
  <script>
    // Test functions
    function testLogin() {
      // Simulate a successful login
      const testSession = {
        staffId: 'DOC001',
        role: 'doctor',
        name: 'Dr. Smith',
        loginTime: new Date().toISOString(),
        isValid: true,
        expiresAt: new Date(Date.now() + 8 * 60 * 60 * 1000).toISOString() // 8 hours
      };
      
      localStorage.setItem('hospitalStaffSession', JSON.stringify(testSession));
      updateSessionStatus();
      
      showModal('Test login successful! Session created for Dr. Smith.', 'success');
    }
    
    function testSession() {
      const session = getSession();
      if (session) {
        showModal(`Active session found!\n\nStaff ID: ${session.staffId}\nRole: ${session.role}\nName: ${session.name}\nLogin Time: ${new Date(session.loginTime).toLocaleString()}`, 'info');
      } else {
        showModal('No active session found.', 'error');
      }
    }
    
    function clearSession() {
      localStorage.removeItem('hospitalStaffSession');
      updateSessionStatus();
      showModal('Session cleared successfully!', 'success');
    }
    
    function testBackButton() {
      showModal('To test the back button functionality:\n\n1. Login to any dashboard\n2. Press the browser back button\n3. You should be logged out and redirected to login page', 'info');
    }
    
    function updateSessionStatus() {
      const session = getSession();
      const sessionInfo = document.getElementById('sessionInfo');
      
      if (session) {
        sessionInfo.innerHTML = `
          <strong>Active Session:</strong><br>
          Staff ID: ${session.staffId}<br>
          Role: ${session.role}<br>
          Name: ${session.name}<br>
          Login: ${new Date(session.loginTime).toLocaleString()}
        `;
        sessionInfo.style.color = '#28a745';
      } else {
        sessionInfo.textContent = 'No active session';
        sessionInfo.style.color = '#dc3545';
      }
      
      // Update login history
      const history = JSON.parse(localStorage.getItem('hospitalLoginHistory') || '[]');
      const historyInfo = document.getElementById('historyInfo');
      
      if (history.length > 0) {
        const recentLogins = history.slice(-3); // Show last 3 logins
        historyInfo.innerHTML = recentLogins.map(login => 
          `${login.staffId} (${login.role}) - ${new Date(login.loginTime).toLocaleString()}`
        ).join('<br>');
      } else {
        historyInfo.textContent = 'No login history';
      }
    }
    
    function showModal(message, type = 'info') {
      const modal = document.getElementById('modal');
      const modalMessage = document.getElementById('modalMessage');
      
      modalMessage.innerHTML = `
        <div class="modal-${type}">
          <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
          <p>${message}</p>
        </div>
      `;
      
      modal.style.display = 'block';
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      updateSessionStatus();
      updateStaffList();
      console.log('Test Staff Login System initialized!');
    });
    
    function updateStaffList() {
      const staffData = localStorage.getItem('hospitalStaffData');
      const staffCountElement = document.getElementById('staffCount');
      
      if (staffData) {
        const staffList = JSON.parse(staffData);
        if (staffList.length > 0) {
          const staffByDept = {};
          staffList.forEach(staff => {
            if (!staffByDept[staff.department]) {
              staffByDept[staff.department] = [];
            }
            staffByDept[staff.department].push({
              id: staff.id,
              name: staff.name,
              password: staff.password
            });
          });
          
          let html = '';
          Object.keys(staffByDept).forEach(dept => {
            html += `<strong>${dept.charAt(0).toUpperCase() + dept.slice(1)}s:</strong><br>`;
            staffByDept[dept].forEach(staff => {
              html += `â€¢ ${staff.id} (${staff.name}) - Password: ${staff.password}<br>`;
            });
            html += '<br>';
          });
          
          staffCountElement.innerHTML = html;
        } else {
          staffCountElement.innerHTML = 'No staff members registered yet.';
        }
      } else {
        staffCountElement.innerHTML = 'No staff data found. Please register staff in admin dashboard.';
      }
    }
    
    function testCrossReference() {
      const staffData = localStorage.getItem('hospitalStaffData');
      
      if (!staffData) {
        showModal('No admin staff data found. Please register staff in admin dashboard first.', 'error');
        return;
      }
      
      const staffList = JSON.parse(staffData);
      if (staffList.length === 0) {
        showModal('No staff members registered in admin dashboard.', 'error');
        return;
      }
      
      // Test the cross-reference function
      const testStaff = staffList[0]; // Use first staff member
      const testRole = testStaff.department;
      
      // Simulate the validation process
      const staffCredentials = {};
      staffList.forEach(staff => {
        let role = '';
        switch(staff.department) {
          case 'doctor': role = 'doctor'; break;
          case 'pharmacist': role = 'pharmacist'; break;
          case 'receptionist': role = 'receptionist'; break;
          case 'labtech': role = 'labtech'; break;
          default: role = staff.department;
        }
        
        staffCredentials[staff.id] = {
          password: staff.password,
          role: role,
          name: staff.name,
          department: staff.department
        };
      });
      
      const credentials = staffCredentials[testStaff.id];
      
      if (credentials) {
        const result = credentials.password === testStaff.password && credentials.role === testRole;
        
        showModal(
          `Cross-Reference Test Results:\n\n` +
          `Test Staff: ${testStaff.name} (${testStaff.id})\n` +
          `Department: ${testStaff.department}\n` +
          `Mapped Role: ${credentials.role}\n` +
          `Password: ${testStaff.password}\n` +
          `Validation: ${result ? 'SUCCESS' : 'FAILED'}\n\n` +
          `Total Staff in System: ${staffList.length}`,
          result ? 'success' : 'error'
        );
      } else {
        showModal('Cross-reference test failed: Staff not found in credentials.', 'error');
      }
    }
  </script>

  <style>
    .test-section {
      background: white;
      border-radius: 10px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .feature-card {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }

    .feature-card h3 {
      margin: 0 0 1rem 0;
      color: #333;
    }

    .feature-card ul {
      margin: 0;
      padding-left: 1.5rem;
    }

    .feature-card li {
      margin-bottom: 0.5rem;
      color: #666;
    }

    .credentials-list h4 {
      color: #333;
      margin: 1rem 0 0.5rem 0;
      font-size: 14px;
    }

    .credentials-list ul {
      margin: 0 0 1rem 0;
      padding-left: 1rem;
    }

    .credentials-list li {
      font-size: 12px;
      margin-bottom: 0.25rem;
    }

    .test-controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin: 1rem 0;
    }

    .test-status {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .status-card {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      border-left: 4px solid #007bff;
    }

    .status-card h3 {
      margin: 0 0 0.5rem 0;
      color: #333;
    }

    .status-card p {
      margin: 0;
      color: #666;
      font-size: 12px;
      line-height: 1.4;
    }

    .dashboard-links {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }

    .dashboard-link {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.5rem;
      background: #f8f9fa;
      border-radius: 8px;
      text-decoration: none;
      color: #333;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .dashboard-link:hover {
      background: #e9ecef;
      border-color: #007bff;
      transform: translateY(-2px);
    }

    .dashboard-link i {
      font-size: 2rem;
      color: #007bff;
      margin-bottom: 0.5rem;
    }

    .dashboard-link span {
      font-weight: 500;
      text-align: center;
    }

    .note {
      margin-top: 1rem;
      padding: 1rem;
      background: #fff3cd;
      border-radius: 5px;
      color: #856404;
      font-size: 14px;
    }

    /* Modal styling */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background-color: #fff;
      margin: 5% auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      position: relative;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .close {
      position: absolute;
      right: 20px;
      top: 20px;
      color: #aaa;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .close:hover {
      color: #333;
    }

    .modal-info,
    .modal-success,
    .modal-error {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .modal-info {
      background: #e3f2fd;
      color: #1976d2;
      border-left: 4px solid #2196f3;
    }

    .modal-success {
      background: #e8f5e8;
      color: #2e7d32;
      border-left: 4px solid #4caf50;
    }

    .modal-error {
      background: #ffebee;
      color: #c62828;
      border-left: 4px solid #f44336;
    }

    .modal-info i,
    .modal-success i,
    .modal-error i {
      font-size: 20px;
    }

    /* Button styling */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-danger {
      background: #dc3545;
      color: #fff;
    }

    .btn-danger:hover {
      background: #c82333;
    }
  </style>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
      <div id="modalMessage"></div>
    </div>
  </div>
</body>
</html> 