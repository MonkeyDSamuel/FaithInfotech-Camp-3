<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Dashboard Communication Test</title>
    <link rel="stylesheet" href="css/admin_dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section h3 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card h4 {
            color: #007bff;
            margin-bottom: 15px;
        }
        .data-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-info { background: #d1ecf1; color: #0c5460; }
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .btn:hover { opacity: 0.8; }
        .clear-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .clear-btn:hover { background: #5a6268; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-exchange-alt"></i> Cross-Dashboard Communication Test</h1>
            <p>Test the functionality of sending prescriptions and lab reports between dashboards</p>
        </header>

        <div class="test-section">
            <h3><i class="fas fa-user-md"></i> Doctor Dashboard Simulation</h3>
            <p>Simulate creating prescriptions and lab reports that will be sent to respective dashboards.</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <h4><i class="fas fa-pills"></i> Prescription Test</h4>
                    <p>Create a test prescription and send it to pharmacist dashboard:</p>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="createTestPrescription()">
                            <i class="fas fa-plus"></i> Create Test Prescription
                        </button>
                        <button class="btn btn-success" onclick="sendPrescriptionToPharmacist()">
                            <i class="fas fa-paper-plane"></i> Send to Pharmacist
                        </button>
                    </div>
                    
                    <div class="data-display" id="prescriptionData">
                        <p><em>No prescription data created yet...</em></p>
                    </div>
                </div>

                <div class="test-card">
                    <h4><i class="fas fa-flask"></i> Lab Report Test</h4>
                    <p>Create a test lab report and send it to lab technician dashboard:</p>
                    
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="createTestLabReport()">
                            <i class="fas fa-plus"></i> Create Test Lab Report
                        </button>
                        <button class="btn btn-success" onclick="sendLabReportToLabTech()">
                            <i class="fas fa-paper-plane"></i> Send to Lab Tech
                        </button>
                    </div>
                    
                    <div class="data-display" id="labReportData">
                        <p><em>No lab report data created yet...</em></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-database"></i> Dashboard Data Status</h3>
            <p>Check the current data in each dashboard's local storage:</p>
            
            <div class="test-grid">
                <div class="test-card">
                    <h4><i class="fas fa-pills"></i> Pharmacist Dashboard Data</h4>
                    <div class="action-buttons">
                        <button class="btn btn-info" onclick="checkPharmacistData()">
                            <i class="fas fa-eye"></i> Check Data
                        </button>
                        <button class="clear-btn" onclick="clearPharmacistData()">
                            <i class="fas fa-trash"></i> Clear Data
                        </button>
                    </div>
                    <div class="data-display" id="pharmacistData">
                        <p><em>Click "Check Data" to view pharmacist dashboard data...</em></p>
                    </div>
                </div>

                <div class="test-card">
                    <h4><i class="fas fa-flask"></i> Lab Technician Dashboard Data</h4>
                    <div class="action-buttons">
                        <button class="btn btn-info" onclick="checkLabTechData()">
                            <i class="fas fa-eye"></i> Check Data
                        </button>
                        <button class="clear-btn" onclick="clearLabTechData()">
                            <i class="fas fa-trash"></i> Clear Data
                        </button>
                    </div>
                    <div class="data-display" id="labTechData">
                        <p><em>Click "Check Data" to view lab technician dashboard data...</em></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3><i class="fas fa-info-circle"></i> Test Instructions</h3>
            <ol>
                <li><strong>Create Test Data:</strong> Click "Create Test Prescription" or "Create Test Lab Report" to generate sample data.</li>
                <li><strong>Send to Dashboard:</strong> Click "Send to Pharmacist" or "Send to Lab Tech" to transfer the data to the respective dashboard's local storage.</li>
                <li><strong>Check Data:</strong> Use "Check Data" buttons to verify that the data was successfully transferred.</li>
                <li><strong>Test Dashboards:</strong> Navigate to the actual dashboard pages to see the data in action.</li>
                <li><strong>Clear Data:</strong> Use "Clear Data" buttons to reset the test data if needed.</li>
            </ol>
            
            <div class="action-buttons">
                <a href="pages/pharmacist.html" class="btn btn-warning" target="_blank">
                    <i class="fas fa-external-link-alt"></i> Open Pharmacist Dashboard
                </a>
                <a href="pages/labtech.html" class="btn btn-warning" target="_blank">
                    <i class="fas fa-external-link-alt"></i> Open Lab Technician Dashboard
                </a>
                <a href="pages/doctor.html" class="btn btn-warning" target="_blank">
                    <i class="fas fa-external-link-alt"></i> Open Doctor Dashboard
                </a>
            </div>
        </div>
    </div>

    <script src="js/staff.js"></script>
    <script>
        // Test data variables
        let testPrescription = null;
        let testLabReport = null;

        // Create test prescription
        function createTestPrescription() {
            testPrescription = {
                id: staffUtils.generateId('PRES'),
                patientId: 'P' + Math.floor(Math.random() * 1000).toString().padStart(3, '0'),
                patientName: 'Test Patient ' + Math.floor(Math.random() * 100),
                date: new Date().toISOString().split('T')[0],
                status: 'pending',
                notes: 'Test prescription notes for demonstration purposes.',
                medicines: 'Paracetamol 500mg - 1 tablet 3 times daily\nAmoxicillin 250mg - 1 capsule twice daily',
                doctorId: 'DOC001',
                doctorName: 'Dr. Test Doctor',
                createdAt: new Date().toISOString()
            };

            displayPrescriptionData();
            console.log('Test prescription created:', testPrescription);
        }

        // Create test lab report
        function createTestLabReport() {
            const testTypes = ['Blood Test', 'Urine Analysis', 'X-Ray', 'ECG', 'MRI Scan'];
            const priorities = ['low', 'normal', 'high', 'urgent'];
            
            testLabReport = {
                id: staffUtils.generateId('LAB'),
                patientId: 'P' + Math.floor(Math.random() * 1000).toString().padStart(3, '0'),
                patientName: 'Test Patient ' + Math.floor(Math.random() * 100),
                date: new Date().toISOString().split('T')[0],
                status: 'pending',
                testType: testTypes[Math.floor(Math.random() * testTypes.length)],
                priority: priorities[Math.floor(Math.random() * priorities.length)],
                notes: 'Test lab report notes for demonstration purposes.',
                doctorId: 'DOC001',
                doctorName: 'Dr. Test Doctor',
                createdAt: new Date().toISOString()
            };

            displayLabReportData();
            console.log('Test lab report created:', testLabReport);
        }

        // Display prescription data
        function displayPrescriptionData() {
            const container = document.getElementById('prescriptionData');
            if (!testPrescription) {
                container.innerHTML = '<p><em>No prescription data created yet...</em></p>';
                return;
            }

            container.innerHTML = `
                <div>
                    <p><strong>ID:</strong> ${testPrescription.id}</p>
                    <p><strong>Patient:</strong> ${testPrescription.patientId} - ${testPrescription.patientName}</p>
                    <p><strong>Doctor:</strong> ${testPrescription.doctorName}</p>
                    <p><strong>Date:</strong> ${testPrescription.date}</p>
                    <p><strong>Status:</strong> <span class="status-indicator status-info">${testPrescription.status}</span></p>
                    <p><strong>Notes:</strong> ${testPrescription.notes}</p>
                    <p><strong>Medicines:</strong></p>
                    <pre style="background: #e9ecef; padding: 10px; border-radius: 4px; margin: 5px 0;">${testPrescription.medicines}</pre>
                </div>
            `;
        }

        // Display lab report data
        function displayLabReportData() {
            const container = document.getElementById('labReportData');
            if (!testLabReport) {
                container.innerHTML = '<p><em>No lab report data created yet...</em></p>';
                return;
            }

            container.innerHTML = `
                <div>
                    <p><strong>ID:</strong> ${testLabReport.id}</p>
                    <p><strong>Patient:</strong> ${testLabReport.patientId} - ${testLabReport.patientName}</p>
                    <p><strong>Doctor:</strong> ${testLabReport.doctorName}</p>
                    <p><strong>Date:</strong> ${testLabReport.date}</p>
                    <p><strong>Test Type:</strong> ${testLabReport.testType}</p>
                    <p><strong>Priority:</strong> <span class="status-indicator status-info">${testLabReport.priority}</span></p>
                    <p><strong>Status:</strong> <span class="status-indicator status-info">${testLabReport.status}</span></p>
                    <p><strong>Notes:</strong> ${testLabReport.notes}</p>
                </div>
            `;
        }

        // Send prescription to pharmacist dashboard
        function sendPrescriptionToPharmacist() {
            if (!testPrescription) {
                alert('Please create a test prescription first!');
                return;
            }

            try {
                // Load existing pharmacist data
                const pharmacistDataKey = 'hospitalPharmacistData';
                let pharmacistData = JSON.parse(localStorage.getItem(pharmacistDataKey) || '[]');
                
                // Add prescription to pharmacist's data
                pharmacistData.push({
                    ...testPrescription,
                    source: 'doctor_dashboard',
                    receivedAt: new Date().toISOString(),
                    status: 'pending'
                });
                
                // Save to pharmacist's local storage
                localStorage.setItem(pharmacistDataKey, JSON.stringify(pharmacistData));
                
                console.log(`Prescription ${testPrescription.id} sent to pharmacist dashboard`);
                console.log('Pharmacist data updated:', pharmacistData.length, 'total prescriptions');
                
                alert('Prescription sent to pharmacist dashboard successfully!');
                checkPharmacistData(); // Refresh the display
            } catch (error) {
                console.error('Error sending prescription to pharmacist:', error);
                alert('Error sending prescription to pharmacist: ' + error.message);
            }
        }

        // Send lab report to lab technician dashboard
        function sendLabReportToLabTech() {
            if (!testLabReport) {
                alert('Please create a test lab report first!');
                return;
            }

            try {
                // Load existing lab technician data
                const labTechDataKey = 'hospitalLabTechData';
                let labTechData = JSON.parse(localStorage.getItem(labTechDataKey) || '[]');
                
                // Add lab report to lab technician's data
                labTechData.push({
                    ...testLabReport,
                    source: 'doctor_dashboard',
                    receivedAt: new Date().toISOString(),
                    status: 'pending'
                });
                
                // Save to lab technician's local storage
                localStorage.setItem(labTechDataKey, JSON.stringify(labTechData));
                
                console.log(`Lab report ${testLabReport.id} sent to lab technician dashboard`);
                console.log('Lab technician data updated:', labTechData.length, 'total lab reports');
                
                alert('Lab report sent to lab technician dashboard successfully!');
                checkLabTechData(); // Refresh the display
            } catch (error) {
                console.error('Error sending lab report to lab technician:', error);
                alert('Error sending lab report to lab technician: ' + error.message);
            }
        }

        // Check pharmacist data
        function checkPharmacistData() {
            try {
                const pharmacistDataKey = 'hospitalPharmacistData';
                const pharmacistData = JSON.parse(localStorage.getItem(pharmacistDataKey) || '[]');
                
                const container = document.getElementById('pharmacistData');
                if (pharmacistData.length === 0) {
                    container.innerHTML = '<p><em>No prescriptions found in pharmacist dashboard...</em></p>';
                    return;
                }

                let html = `<p><strong>Total Prescriptions:</strong> ${pharmacistData.length}</p>`;
                html += '<div style="max-height: 150px; overflow-y: auto;">';
                
                pharmacistData.forEach((prescription, index) => {
                    html += `
                        <div style="border: 1px solid #dee2e6; margin: 5px 0; padding: 10px; border-radius: 4px;">
                            <p><strong>${index + 1}.</strong> ${prescription.patientName} (${prescription.patientId})</p>
                            <p><strong>Doctor:</strong> ${prescription.doctorName || 'Unknown'}</p>
                            <p><strong>Status:</strong> <span class="status-indicator status-info">${prescription.status}</span></p>
                            <p><strong>Received:</strong> ${prescription.receivedAt ? new Date(prescription.receivedAt).toLocaleString() : 'N/A'}</p>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error checking pharmacist data:', error);
                document.getElementById('pharmacistData').innerHTML = '<p style="color: red;">Error loading pharmacist data</p>';
            }
        }

        // Check lab technician data
        function checkLabTechData() {
            try {
                const labTechDataKey = 'hospitalLabTechData';
                const labTechData = JSON.parse(localStorage.getItem(labTechDataKey) || '[]');
                
                const container = document.getElementById('labTechData');
                if (labTechData.length === 0) {
                    container.innerHTML = '<p><em>No lab reports found in lab technician dashboard...</em></p>';
                    return;
                }

                let html = `<p><strong>Total Lab Reports:</strong> ${labTechData.length}</p>`;
                html += '<div style="max-height: 150px; overflow-y: auto;">';
                
                labTechData.forEach((labReport, index) => {
                    html += `
                        <div style="border: 1px solid #dee2e6; margin: 5px 0; padding: 10px; border-radius: 4px;">
                            <p><strong>${index + 1}.</strong> ${labReport.patientName} (${labReport.patientId})</p>
                            <p><strong>Test:</strong> ${labReport.testType}</p>
                            <p><strong>Doctor:</strong> ${labReport.doctorName || 'Unknown'}</p>
                            <p><strong>Priority:</strong> <span class="status-indicator status-info">${labReport.priority}</span></p>
                            <p><strong>Status:</strong> <span class="status-indicator status-info">${labReport.status}</span></p>
                            <p><strong>Received:</strong> ${labReport.receivedAt ? new Date(labReport.receivedAt).toLocaleString() : 'N/A'}</p>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error checking lab technician data:', error);
                document.getElementById('labTechData').innerHTML = '<p style="color: red;">Error loading lab technician data</p>';
            }
        }

        // Clear pharmacist data
        function clearPharmacistData() {
            if (confirm('Are you sure you want to clear all pharmacist dashboard data?')) {
                localStorage.removeItem('hospitalPharmacistData');
                checkPharmacistData();
                alert('Pharmacist dashboard data cleared!');
            }
        }

        // Clear lab technician data
        function clearLabTechData() {
            if (confirm('Are you sure you want to clear all lab technician dashboard data?')) {
                localStorage.removeItem('hospitalLabTechData');
                checkLabTechData();
                alert('Lab technician dashboard data cleared!');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Cross-Dashboard Communication Test initialized!');
            checkPharmacistData();
            checkLabTechData();
        });
    </script>
</body>
</html> 