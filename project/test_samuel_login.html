<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Samuel Login - Cross-Reference Verification</title>
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>
    <div class="test-container">
        <header class="test-header">
            <h1><i class="fas fa-user-md"></i> Samuel Login Test</h1>
            <p>Testing cross-reference with actual admin data</p>
        </header>

        <div class="test-sections">
            <div class="test-section">
                <h2><i class="fas fa-database"></i> Current Admin Data</h2>
                <div class="data-display">
                    <h4>Staff Member Details:</h4>
                    <div id="samuelData" class="staff-data">
                        Loading Samuel's data...
                    </div>
                </div>
                <button onclick="loadSamuelData()" class="btn btn-primary">
                    <i class="fas fa-sync"></i> Refresh Data
                </button>
            </div>

            <div class="test-section">
                <h2><i class="fas fa-sign-in-alt"></i> Login Test</h2>
                <div class="login-test">
                    <div class="test-credentials">
                        <h4>Test Credentials:</h4>
                        <ul>
                            <li><strong>Staff ID:</strong> <code id="testStaffId">DOC0001</code></li>
                            <li><strong>Password:</strong> <code id="testPassword">SamuelDOC0001</code></li>
                            <li><strong>Role:</strong> <code id="testRole">doctor</code></li>
                            <li><strong>Name:</strong> <code id="testName">Samuel Thomas Mathew S</code></li>
                            <li><strong>Department:</strong> <code id="testDepartment">doctor</code></li>
                            <li><strong>Position:</strong> <code id="testPosition">Cardiologist</code></li>
                        </ul>
                    </div>
                    
                    <div class="test-form">
                        <h4>Test Login:</h4>
                        <div class="input-group">
                            <label>Staff ID:</label>
                            <input type="text" id="loginStaffId" value="DOC0001" placeholder="Enter Staff ID">
                        </div>
                        <div class="input-group">
                            <label>Password:</label>
                            <input type="password" id="loginPassword" value="SamuelDOC0001" placeholder="Enter Password">
                        </div>
                        <div class="input-group">
                            <label>Role:</label>
                            <select id="loginRole">
                                <option value="">Select Role</option>
                                <option value="doctor" selected>Doctor</option>
                                <option value="pharmacist">Pharmacist</option>
                                <option value="receptionist">Receptionist</option>
                                <option value="labtech">Lab Technician</option>
                            </select>
                        </div>
                        <button onclick="testSamuelLogin()" class="btn btn-success">
                            <i class="fas fa-check"></i> Test Login
                        </button>
                    </div>
                </div>
                <div id="loginResult" class="result-box"></div>
            </div>

            <div class="test-section">
                <h2><i class="fas fa-route"></i> Cross-Reference Process</h2>
                <div class="process-steps">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Load Admin Data</h4>
                            <p>Read <code>hospitalStaffData</code> from localStorage</p>
                            <div id="step1Result" class="step-result">Waiting...</div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Map Department to Role</h4>
                            <p>Convert <code>department: "doctor"</code> to <code>role: "doctor"</code></p>
                            <div id="step2Result" class="step-result">Waiting...</div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Validate Credentials</h4>
                            <p>Check Staff ID, Password, and Role match</p>
                            <div id="step3Result" class="step-result">Waiting...</div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Create Session</h4>
                            <p>Store user session with all staff information</p>
                            <div id="step4Result" class="step-result">Waiting...</div>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Redirect to Dashboard</h4>
                            <p>Redirect to <code>doctor_dashboard.html</code></p>
                            <div id="step5Result" class="step-result">Waiting...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h2><i class="fas fa-cogs"></i> Test Actions</h2>
                <div class="test-actions">
                    <button onclick="runFullTest()" class="btn btn-primary">
                        <i class="fas fa-play"></i> Run Full Test
                    </button>
                    <button onclick="testInvalidCredentials()" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Test Invalid Credentials
                    </button>
                    <button onclick="testWrongRole()" class="btn btn-secondary">
                        <i class="fas fa-exclamation"></i> Test Wrong Role
                    </button>
                    <button onclick="clearTestResults()" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Clear Results
                    </button>
                </div>
            </div>
        </div>

        <div class="test-actions">
            <button onclick="window.location.href='pages/staff_login.html'" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i> Go to Staff Login
            </button>
            <button onclick="window.location.href='pages/doctor_dashboard.html'" class="btn btn-secondary">
                <i class="fas fa-user-md"></i> Go to Doctor Dashboard
            </button>
            <button onclick="window.location.href='demo_cross_reference.html'" class="btn btn-secondary">
                <i class="fas fa-info-circle"></i> Cross-Reference Demo
            </button>
        </div>
    </div>

    <script>
        // Load Samuel's data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadSamuelData();
        });

        function loadSamuelData() {
            const staffData = localStorage.getItem('hospitalStaffData');
            const samuelDataElement = document.getElementById('samuelData');
            
            if (staffData) {
                const staffList = JSON.parse(staffData);
                const samuel = staffList.find(staff => staff.id === 'DOC0001');
                
                if (samuel) {
                    samuelDataElement.innerHTML = `
                        <div class="staff-info">
                            <p><strong>ID:</strong> ${samuel.id}</p>
                            <p><strong>Name:</strong> ${samuel.name}</p>
                            <p><strong>Email:</strong> ${samuel.email}</p>
                            <p><strong>Phone:</strong> ${samuel.phone}</p>
                            <p><strong>Department:</strong> ${samuel.department}</p>
                            <p><strong>Position:</strong> ${samuel.position}</p>
                            <p><strong>Password:</strong> ${samuel.password}</p>
                            <p><strong>Address:</strong> ${samuel.address}</p>
                            <p><strong>Consultation Fee:</strong> ₹${samuel.consultationFee}</p>
                            <p><strong>Working Days:</strong> ${samuel.workingDays.join(', ')}</p>
                            <p><strong>Working Hours:</strong> ${samuel.workingHours.start} - ${samuel.workingHours.end}</p>
                        </div>
                    `;
                    
                    // Update test credentials
                    document.getElementById('testStaffId').textContent = samuel.id;
                    document.getElementById('testPassword').textContent = samuel.password;
                    document.getElementById('testRole').textContent = samuel.department;
                    document.getElementById('testName').textContent = samuel.name;
                    document.getElementById('testDepartment').textContent = samuel.department;
                    document.getElementById('testPosition').textContent = samuel.position;
                    
                    // Update form values
                    document.getElementById('loginStaffId').value = samuel.id;
                    document.getElementById('loginPassword').value = samuel.password;
                    document.getElementById('loginRole').value = samuel.department;
                    
                } else {
                    samuelDataElement.innerHTML = '<p class="error">Samuel (DOC0001) not found in admin data</p>';
                }
            } else {
                samuelDataElement.innerHTML = '<p class="error">No admin data found</p>';
            }
        }

        function testSamuelLogin() {
            const staffId = document.getElementById('loginStaffId').value.trim();
            const password = document.getElementById('loginPassword').value;
            const role = document.getElementById('loginRole').value;
            
            if (!staffId || !password || !role) {
                showResult('Please fill in all fields', 'error');
                return;
            }

            // Step 1: Load admin data
            const staffData = localStorage.getItem('hospitalStaffData');
            if (!staffData) {
                showResult('No admin staff data found', 'error');
                updateStepResult('step1Result', '❌ Failed - No data found', 'error');
                return;
            }
            updateStepResult('step1Result', '✅ Success - Data loaded', 'success');

            const staffList = JSON.parse(staffData);
            const samuel = staffList.find(staff => staff.id === staffId);
            
            if (!samuel) {
                showResult(`Staff ID "${staffId}" not found`, 'error');
                updateStepResult('step2Result', '❌ Failed - Staff not found', 'error');
                return;
            }

            // Step 2: Map department to role
            let mappedRole = '';
            switch(samuel.department) {
                case 'doctor': mappedRole = 'doctor'; break;
                case 'pharmacist': mappedRole = 'pharmacist'; break;
                case 'receptionist': mappedRole = 'receptionist'; break;
                case 'labtech': mappedRole = 'labtech'; break;
                default: mappedRole = samuel.department;
            }
            updateStepResult('step2Result', `✅ Success - Mapped to ${mappedRole}`, 'success');

            // Step 3: Validate credentials
            if (samuel.password !== password) {
                showResult(`Password mismatch for ${staffId}`, 'error');
                updateStepResult('step3Result', '❌ Failed - Password mismatch', 'error');
                return;
            }

            if (mappedRole !== role) {
                showResult(`Role mismatch. Expected: ${mappedRole}, Got: ${role}`, 'error');
                updateStepResult('step3Result', '❌ Failed - Role mismatch', 'error');
                return;
            }
            updateStepResult('step3Result', '✅ Success - Credentials valid', 'success');

            // Step 4: Create session
            const session = {
                staffId: staffId,
                role: role,
                name: samuel.name,
                department: samuel.department,
                position: samuel.position,
                email: samuel.email,
                phone: samuel.phone,
                loginTime: new Date().toISOString(),
                isValid: true
            };
            updateStepResult('step4Result', '✅ Success - Session created', 'success');

            // Step 5: Redirect
            const dashboardMap = {
                'doctor': 'doctor_dashboard.html',
                'pharmacist': 'pharmacist_dashboard.html',
                'receptionist': 'receptionist_dashboard.html',
                'labtech': 'labtech_dashboard.html'
            };
            const dashboard = dashboardMap[role];
            updateStepResult('step5Result', `✅ Success - Redirecting to ${dashboard}`, 'success');

            showResult(
                `✅ Login successful!\n\n` +
                `Staff: ${samuel.name}\n` +
                `Department: ${samuel.department}\n` +
                `Position: ${samuel.position}\n` +
                `Redirecting to: ${dashboard}`,
                'success'
            );
        }

        function runFullTest() {
            clearTestResults();
            setTimeout(() => {
                testSamuelLogin();
            }, 500);
        }

        function testInvalidCredentials() {
            document.getElementById('loginPassword').value = 'WrongPassword';
            testSamuelLogin();
        }

        function testWrongRole() {
            document.getElementById('loginRole').value = 'pharmacist';
            testSamuelLogin();
        }

        function clearTestResults() {
            const steps = ['step1Result', 'step2Result', 'step3Result', 'step4Result', 'step5Result'];
            steps.forEach(step => {
                updateStepResult(step, 'Waiting...', 'waiting');
            });
            document.getElementById('loginResult').innerHTML = '';
        }

        function updateStepResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `step-result ${type}`;
        }

        function showResult(message, type) {
            const resultElement = document.getElementById('loginResult');
            resultElement.innerHTML = `<div class="${type}-result">${message}</div>`;
        }
    </script>

    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }

        .test-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2.5rem;
        }

        .test-sections {
            display: grid;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-display {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #007bff;
        }

        .staff-info p {
            margin: 0.5rem 0;
            font-family: monospace;
        }

        .login-test {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1rem 0;
        }

        .test-credentials {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
        }

        .test-credentials ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .test-credentials li {
            margin-bottom: 0.5rem;
        }

        .test-form {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
        }

        .input-group {
            display: grid;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .input-group label {
            font-weight: 500;
            color: #333;
        }

        .input-group input,
        .input-group select {
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
        }

        .result-box {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .success-result {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-result {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .process-steps {
            display: grid;
            gap: 1rem;
        }

        .step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .step-number {
            background: #28a745;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
        }

        .step-content p {
            margin: 0 0 0.5rem 0;
            color: #666;
        }

        .step-result {
            font-family: monospace;
            font-size: 12px;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            background: #e9ecef;
        }

        .step-result.success {
            background: #d4edda;
            color: #155724;
        }

        .step-result.error {
            background: #f8d7da;
            color: #721c24;
        }

        .step-result.waiting {
            background: #fff3cd;
            color: #856404;
        }

        .test-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: #fff;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: #fff;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        code {
            background: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .login-test {
                grid-template-columns: 1fr;
            }
            
            .test-container {
                padding: 10px;
            }
            
            .test-section {
                padding: 1rem;
            }
        }
    </style>
</body>
</html> 