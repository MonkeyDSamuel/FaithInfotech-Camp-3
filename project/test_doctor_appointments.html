<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Doctor Appointments - Cross-Reference Demo</title>
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>
    <div class="test-container">
        <header class="test-header">
            <h1><i class="fas fa-user-md"></i> Doctor Appointments Test</h1>
            <p>Testing how doctor dashboard loads appointments from receptionist's local storage</p>
        </header>

        <div class="test-sections">
            <div class="test-section">
                <h2><i class="fas fa-database"></i> Receptionist's Patient Data</h2>
                <div class="data-display">
                    <h4>All Patients with Appointments:</h4>
                    <div id="receptionistData" class="patient-data">
                        Loading receptionist data...
                    </div>
                </div>
                <button onclick="loadReceptionistData()" class="btn btn-primary">
                    <i class="fas fa-sync"></i> Refresh Receptionist Data
                </button>
            </div>

            <div class="test-section">
                <h2><i class="fas fa-user-shield"></i> Current Doctor Session</h2>
                <div class="session-info">
                    <div id="doctorSession" class="session-data">
                        Loading session data...
                    </div>
                </div>
                <button onclick="checkDoctorSession()" class="btn btn-secondary">
                    <i class="fas fa-check"></i> Check Session
                </button>
            </div>

            <div class="test-section">
                <h2><i class="fas fa-calendar-check"></i> Doctor's Appointments</h2>
                <div class="appointments-test">
                    <div class="test-controls">
                        <button onclick="testTodayAppointments()" class="btn btn-success">
                            <i class="fas fa-calendar-day"></i> Test Today's Appointments
                        </button>
                        <button onclick="testFutureAppointments()" class="btn btn-info">
                            <i class="fas fa-calendar-week"></i> Test Future Appointments
                        </button>
                        <button onclick="testAllAppointments()" class="btn btn-secondary">
                            <i class="fas fa-calendar-alt"></i> Test All Appointments
                        </button>
                    </div>
                    
                    <div class="appointment-results">
                        <h4>Today's Appointments:</h4>
                        <div id="todayResults" class="result-box"></div>
                        
                        <h4>Future Appointments:</h4>
                        <div id="futureResults" class="result-box"></div>
                        
                        <h4>All Appointments for Current Doctor:</h4>
                        <div id="allResults" class="result-box"></div>
                    </div>
                </div>
            </div>

            <div class="test-section">
                <h2><i class="fas fa-info-circle"></i> How It Works</h2>
                <div class="process-flow">
                    <div class="flow-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Receptionist Creates Appointments</h4>
                            <p>Receptionist registers patients and assigns them to doctors with appointment dates/times</p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Data Stored in Receptionist's Local Storage</h4>
                            <p>All patient data with appointments stored under <code>hospitalPatientData</code></p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Doctor Logs In</h4>
                            <p>Doctor authenticates and session stores their Staff ID</p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>Doctor Dashboard Loads</h4>
                            <p>Dashboard reads receptionist's data and filters by current doctor's ID</p>
                        </div>
                    </div>
                    <div class="flow-step">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>Appointments Displayed</h4>
                            <p>Only appointments assigned to the logged-in doctor are shown</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="test-actions">
            <button onclick="window.location.href='pages/staff_login.html'" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i> Login as Doctor
            </button>
            <button onclick="window.location.href='pages/doctor_dashboard.html'" class="btn btn-secondary">
                <i class="fas fa-user-md"></i> Go to Doctor Dashboard
            </button>
            <button onclick="window.location.href='pages/receptionist_dashboard.html'" class="btn btn-secondary">
                <i class="fas fa-user-tie"></i> Go to Receptionist Dashboard
            </button>
        </div>
    </div>

    <script>
        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadReceptionistData();
            checkDoctorSession();
        });

        function loadReceptionistData() {
            const patientData = localStorage.getItem('hospitalPatientData');
            const receptionistDataElement = document.getElementById('receptionistData');
            
            if (patientData) {
                const patients = JSON.parse(patientData);
                if (patients.length > 0) {
                    let html = '<div class="patient-list">';
                    patients.forEach(patient => {
                        html += `
                            <div class="patient-item">
                                <strong>${patient.id}</strong> - ${patient.name}<br>
                                <small>Doctor: ${patient.doctor} | Date: ${patient.appointmentDate} | Time: ${patient.appointmentTime}</small>
                            </div>
                        `;
                    });
                    html += '</div>';
                    receptionistDataElement.innerHTML = html;
                } else {
                    receptionistDataElement.innerHTML = '<p class="no-data">No patients found in receptionist data</p>';
                }
            } else {
                receptionistDataElement.innerHTML = '<p class="no-data">No receptionist data found</p>';
            }
        }

        function checkDoctorSession() {
            const sessionData = localStorage.getItem('hospitalStaffSession');
            const sessionElement = document.getElementById('doctorSession');
            
            if (sessionData) {
                const session = JSON.parse(sessionData);
                if (session.isValid && session.role === 'doctor') {
                    sessionElement.innerHTML = `
                        <div class="valid-session">
                            <h4>✅ Valid Doctor Session</h4>
                            <p><strong>Staff ID:</strong> ${session.staffId}</p>
                            <p><strong>Name:</strong> ${session.name}</p>
                            <p><strong>Role:</strong> ${session.role}</p>
                            <p><strong>Department:</strong> ${session.department}</p>
                            <p><strong>Login Time:</strong> ${new Date(session.loginTime).toLocaleString()}</p>
                        </div>
                    `;
                } else {
                    sessionElement.innerHTML = `
                        <div class="invalid-session">
                            <h4>❌ Invalid Session</h4>
                            <p>Role: ${session.role} (Expected: doctor)</p>
                            <p>Please login as a doctor to test appointments</p>
                        </div>
                    `;
                }
            } else {
                sessionElement.innerHTML = `
                    <div class="no-session">
                        <h4>❌ No Session Found</h4>
                        <p>Please login as a doctor first</p>
                    </div>
                `;
            }
        }

        function testTodayAppointments() {
            const patientData = localStorage.getItem('hospitalPatientData');
            const sessionData = localStorage.getItem('hospitalStaffSession');
            const resultsElement = document.getElementById('todayResults');
            
            if (!patientData || !sessionData) {
                resultsElement.innerHTML = '<div class="error-result">No data available</div>';
                return;
            }
            
            const patients = JSON.parse(patientData);
            const session = JSON.parse(sessionData);
            const today = new Date().toISOString().split('T')[0];
            
            if (session.role !== 'doctor') {
                resultsElement.innerHTML = '<div class="error-result">Not logged in as doctor</div>';
                return;
            }
            
            const todayAppointments = patients.filter(patient => 
                patient.doctor === session.staffId && 
                patient.appointmentDate === today
            );
            
            if (todayAppointments.length > 0) {
                let html = '<div class="success-result">';
                todayAppointments.forEach(appointment => {
                    html += `
                        <div class="appointment-item">
                            <strong>${appointment.id}</strong> - ${appointment.name}<br>
                            <small>Time: ${appointment.appointmentTime} | Symptoms: ${appointment.symptoms || 'N/A'}</small>
                        </div>
                    `;
                });
                html += '</div>';
                resultsElement.innerHTML = html;
            } else {
                resultsElement.innerHTML = '<div class="info-result">No appointments for today</div>';
            }
        }

        function testFutureAppointments() {
            const patientData = localStorage.getItem('hospitalPatientData');
            const sessionData = localStorage.getItem('hospitalStaffSession');
            const resultsElement = document.getElementById('futureResults');
            
            if (!patientData || !sessionData) {
                resultsElement.innerHTML = '<div class="error-result">No data available</div>';
                return;
            }
            
            const patients = JSON.parse(patientData);
            const session = JSON.parse(sessionData);
            const today = new Date().toISOString().split('T')[0];
            
            if (session.role !== 'doctor') {
                resultsElement.innerHTML = '<div class="error-result">Not logged in as doctor</div>';
                return;
            }
            
            const futureAppointments = patients.filter(patient => 
                patient.doctor === session.staffId && 
                patient.appointmentDate > today
            );
            
            if (futureAppointments.length > 0) {
                let html = '<div class="success-result">';
                futureAppointments.forEach(appointment => {
                    html += `
                        <div class="appointment-item">
                            <strong>${appointment.id}</strong> - ${appointment.name}<br>
                            <small>Date: ${appointment.appointmentDate} | Time: ${appointment.appointmentTime}</small>
                        </div>
                    `;
                });
                html += '</div>';
                resultsElement.innerHTML = html;
            } else {
                resultsElement.innerHTML = '<div class="info-result">No future appointments</div>';
            }
        }

        function testAllAppointments() {
            const patientData = localStorage.getItem('hospitalPatientData');
            const sessionData = localStorage.getItem('hospitalStaffSession');
            const resultsElement = document.getElementById('allResults');
            
            if (!patientData || !sessionData) {
                resultsElement.innerHTML = '<div class="error-result">No data available</div>';
                return;
            }
            
            const patients = JSON.parse(patientData);
            const session = JSON.parse(sessionData);
            
            if (session.role !== 'doctor') {
                resultsElement.innerHTML = '<div class="error-result">Not logged in as doctor</div>';
                return;
            }
            
            const allAppointments = patients.filter(patient => 
                patient.doctor === session.staffId
            );
            
            if (allAppointments.length > 0) {
                let html = '<div class="success-result">';
                allAppointments.forEach(appointment => {
                    html += `
                        <div class="appointment-item">
                            <strong>${appointment.id}</strong> - ${appointment.name}<br>
                            <small>Date: ${appointment.appointmentDate} | Time: ${appointment.appointmentTime} | Status: ${appointment.status || 'Scheduled'}</small>
                        </div>
                    `;
                });
                html += '</div>';
                resultsElement.innerHTML = html;
            } else {
                resultsElement.innerHTML = '<div class="info-result">No appointments found for this doctor</div>';
            }
        }
    </script>

    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }

        .test-header h1 {
            margin: 0 0 0.5rem 0;
            font-size: 2.5rem;
        }

        .test-sections {
            display: grid;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .test-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .test-section h2 {
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .data-display, .session-info {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #007bff;
        }

        .patient-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .patient-item {
            padding: 0.5rem;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }

        .patient-item:last-child {
            border-bottom: none;
        }

        .valid-session {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid #28a745;
        }

        .invalid-session, .no-session {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid #dc3545;
        }

        .appointments-test {
            margin: 1rem 0;
        }

        .test-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .appointment-results h4 {
            margin: 1rem 0 0.5rem 0;
            color: #333;
        }

        .result-box {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
        }

        .success-result {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-result {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info-result {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .appointment-item {
            padding: 0.5rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .appointment-item:last-child {
            border-bottom: none;
        }

        .process-flow {
            display: grid;
            gap: 1rem;
        }

        .flow-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .step-number {
            background: #28a745;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 0.5rem 0;
            color: #333;
        }

        .step-content p {
            margin: 0;
            color: #666;
        }

        .test-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: #fff;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-info {
            background: #17a2b8;
            color: #fff;
        }

        .btn-info:hover {
            background: #138496;
        }

        code {
            background: #e9ecef;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }

        .no-data {
            color: #6c757d;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .test-container {
                padding: 10px;
            }
            
            .test-section {
                padding: 1rem;
            }
            
            .test-controls {
                flex-direction: column;
            }
        }
    </style>
</body>
</html> 